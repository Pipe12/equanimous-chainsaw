<div class="container">
  <div class="row">
    <div class="col-sm-6 col-sm-offset-3">
      <table class="table">
        <tr>
          <th>Filename</th>
          <td class="text-center"><%= @file_analysis.filename %></td>
        </tr>
        <tr>
          <th>Status</th>
          <td class="text-center status"><%= @file_analysis.status %></td>
        </tr>
        <tr>
          <th>Analyzed Rows</th>
          <td class="text-center analyzed-rows"><%= @file_analysis.analyzed_rows %></td>
        </tr>
      </table>
    </div>
  </div>
</div>

<script src="https://js.pusher.com/3.0/pusher.min.js"></script>
<script>
  // Enable pusher logging - don't include this in production
  // Pusher.log = function(message) {
  //   if (window.console && window.console.log) {
  //     window.console.log(message);
  //   }
  // };

  var pusher = new Pusher('<%= PUSHER_KEY %>', {
    encrypted: true
  });
  var channel = pusher.subscribe('file-analysis-<%= @file_analysis.id %>');
  channel.bind('update', function(data) {
    var fileAnalysis = JSON.parse(data.message);
    $('.status').html(fileAnalysis.status);
    $('.analyzed-rows').html(fileAnalysis['analyzed_rows']);
  });

  channel.bind('finished', function(data) {
    $('.analyzed-rows').html("finished");
  });
</script>